#compdef gitter

# Copyright (C) Indrajit Roy <eendroroy@gmail.com>
#
# SPDX-License-Identifier: AGPL-3.0-or-later
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU Affero General Public License as
# published by the Free Software Foundation, either version 3 of the
# License, or (at your option) any later version.

# shellcheck disable=SC2154
# shellcheck disable=SC2034
_gitter() {
  emulate -L zsh
  setopt extendedglob nullglob

  local -a commands pattern_prefixes
  commands=(
    "git:Run a git command (default)"
    "g:Run a git command (default)"
    "exec:Run an arbitrary command"
    "x:Run an arbitrary command"
    "list:List repositories only"
    "ls:List repositories only"
    "ll:Equivalent to list --verbose command"
    "help:Show help, takes optional topic argument"
    "config:Print current (effective) configuration"
    "--status:Custom status format using placeholders"
    "-s:Custom status format using placeholders"
    "--max-depth:Max depth to search for git repositories (default: infinite)"
    "-d:Max depth to search for git repositories (default: infinite)"
    "--exclude:Exclude matched repositories instead of including"
    "-e:Exclude matched repositories instead of including"
    "--filter:Filter repositories matching the given pattern (can be specified multiple times)"
    "-f:Filter repositories matching the given pattern (can be specified multiple times)"
    "--ask-confirmation:Ask for confirmation before executing commands"
    "-a:Ask for confirmation before executing commands"
    "--continue-on-error:Continue executing commands even if some repositories result in errors"
    "-c:Continue executing commands even if some repositories result in errors"
    "--quiet:Enable quiet mode, minimal output"
    "-q:Enable quiet mode, minimal output"
    "--no-color:Disable colored output"
    "--verbose:Enable verbose mode"
    "-v:Enable verbose mode"
    "--dry-run:Show what would be done without actually executing commands"
    "-n:Show what would be done without actually executing commands"
    "--:End of command options, all following arguments are treated as positional arguments"
  )

  pattern_prefixes=(
    "path\:_path_:Match by full path - replace '_path_' with desired value"
    "path\:_path_+:Match by path prefix - replace '_path_' with desired value"
    "path\:+_path_:Match by path suffix - replace '_path_' with desired value"
    "path\:+_path_+:Match by path substring - replace '_path_' with desired value"
    "repo\:_repo_:Match by repository name - replace '_repo_' with desired value"
    "repo\:_repo_+:Match by repository name prefix - replace '_repo_' with desired value"
    "repo\:+_repo_:Match by repository name suffix - replace '_repo_' with desired value"
    "repo\:+_repo_+:Match by repository name substring - replace '_repo_' with desired value"
    "branch\:_branch_:Match by current branch name - replace '_branch_' with desired value"
    "branch\:_branch_+:Match by current branch name prefix - replace '_branch_' with desired value"
    "branch\:+_branch_:Match by current branch name suffix - replace '_branch_' with desired value"
    "branch\:+_branch_+:Match by current branch name substring - replace '_branch_' with desired value"
  )

  helps=(
    "filter:Show help about filter patterns"
    "gitterignore:Show help about .gitterignore file"
    "expander:Show help about available expanders"
    "status:Show help about status placeholders"
  )

  _arguments -C \
    '--filter:pattern:->pattern' \
    '-f:pattern:->pattern' \
    '1:command:->command' \
    '2:help:->help' \
    '*::args:->args'

  case $state in
    command)
      _describe 'gitter commands' commands
      return
      ;;
    pattern)
      _describe 'pattern prefix' pattern_prefixes
      return
      ;;
    help)
      _describe 'help topics' helps
      return
  esac
}

compdef _gitter gitter
