#compdef gitter

# Copyright (C) Indrajit Roy <eendroroy@gmail.com>
#
# SPDX-License-Identifier: AGPL-3.0-or-later
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU Affero General Public License as
# published by the Free Software Foundation, either version 3 of the
# License, or (at your option) any later version.

# shellcheck disable=SC2154
# shellcheck disable=SC2034
_gitter() {
  emulate -L zsh
  setopt extendedglob nullglob

  local -a commands pattern_prefixes
  commands=(
    "git:Run a git command (default)"
    "g:Run a git command (default)"
    "exec:Run an arbitrary command"
    "x:Run an arbitrary command"
    "eval:Evaluate a shell command - useful for complex commands involving pipes and redirections"
    "e:Evaluate a shell command - useful for complex commands involving pipes and redirections"
    "bash:Execute a bash script file"
    "b:Execute a bash script file"
    "list:List repositories only"
    "ls:List repositories only"
    "help:Show help, takes optional topic argument"
    "config:Print current (effective) configuration"
    "--status:Custom status format using placeholders"
    "-s:Custom status format using placeholders"
    "--max-depth:Max depth to search for git repositories (default: infinite)"
    "-d:Max depth to search for git repositories (default: infinite)"
    "--exclude:Exclude matched repositories instead of including"
    "-e:Exclude matched repositories instead of including"
    "--filter:Filter repositories matching the given pattern (Run 'gitter help filter' for details)"
    "-f:Filter repositories matching the given pattern (Run 'gitter help filter' for details)"
    "--processable:Processable output"
    "-p:Processable output"
    "--ask-confirmation:Ask for confirmation before executing commands"
    "-a:Ask for confirmation before executing commands"
    "--continue-on-error:Continue executing commands even if some repositories result in errors"
    "-c:Continue executing commands even if some repositories result in errors"
    "--no-color:Disable colored output"
    "--dry-run:Show what would be done without actually executing commands"
    "-n:Show what would be done without actually executing commands"
    "--:End of command options, all following arguments are treated as positional arguments"
  )

  statuses=(
    "branch:\" |[type]| on |[branch]\""
    "updated:\" |[type]| on |[branch]| |[time:r]\""
    "updated-at:\" |[type]| on |[branch]| |[commit:8]| at |[time:d]\""
    "updated-by:\" |[type]| on |[branch]| |[commit:8]| by |[author:e]| |[time:r]\""
    "updated-by-at:\" |[type]| on |[branch]| |[commit:8]| by |[author:e]| at |[time:d]\""
    "commit-count:\" (|[commit:c]| commits)| on |[branch]\""
    ":provide custom format using placeholders (see 'gitter help status' for details)"
  )

  helps=(
    "filter:Show help about filter patterns"
    "gitterignore:Show help about .gitterignore file"
    "expander:Show help about available expanders"
    "status:Show help about status placeholders"
  )

  _arguments -C \
    '--status:status:->status' \
    '-s:status:->status' \
    '1:command:->command' \
    '2:help:->help' \
    '*::args:->args'

  case $state in
    command)
      _describe 'gitter commands' commands
      return
      ;;
    status)
      _describe 'status' statuses
      return
      ;;
    help)
      _describe 'help topics' helps
      return
  esac
}

compdef _gitter gitter
